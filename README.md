#  NYC Respiratory Virus Data Tracker

This project powers a responsive, modular dashboard for the NYC Department of Health and Mental Hygiene (DOHMH), visualizing respiratory virus trends across COVID-19, Influenza, RSV, ARI, and more. It supports seasonal comparisons, chart explainers, plain-language summaries, and interactive data filtering.

---

## üìÅ Project Structure
  /components
  * cards/ # Stat cards (e.g. COVID, Flu)
  * charts/ # Vega-lite chart wrappers
  * contentUtils/ # Markdown rendering & text utilities
  * controls/ # Virus and view toggle components
  * grids/ # Layout grid components
  * layout/ # Page layouts, container logic
  * popups/ # Info modal components
  
  /public/content
  * sections/ # Summary markdown (e.g. edSectionText.md)
  * modals/ # Chart explainer markdown
  
  /data
  * edPageConfig.js # Config for Emergency Dept page
  * caseDataPageConfig.js
  * covidDeathPageConfig.js
  
  /utils
  * chartRegistry.js # Dynamic chart registry
  * contentUtils.js # Dot notation text resolver
  * downloadUtils.js # CSV export helper
  * trendUtils.js # Calculates week-over-week trends
  * loadMarkdownWithMeta.js

## ‚öôÔ∏è Config-Driven Architecture
The ConfigDrivenPage system enables you to build a fully functional data dashboard page from a simple configuration object. This promotes consistency and makes it easier to scale or maintain new pages without duplicating rendering logic.

Below is a commented example configuration for a page:
### Example

```js
{
  id: "emergencyDeptPage", // Unique ID for the page (used for routing, styling, etc.)

  titleKey: "emergencyDeptPage.mainTitle", 
  // i18n-compatible key that maps to a human-readable page title in `text.json`.

  summary: {
    title: "Page Overview", // Optional heading for the summary block.
    markdownPath: "../../public/content/sections/edSectionText.md", 
    // Markdown file rendered at the top of the page as a summary or intro.
    lastUpdated: "05/10/2025", // Optional date string.
    showTrendArrow: true, // Optional: show upward/downward trend icon.
    animateOnScroll: true // Optional: controls fade-in animation.
  },

  sections: [
    {
      title: "emergencyDeptPage.charts.seasonalEdVisits.title",
      // Title shown above the chart. Can be a key from text.json or raw string.

      chart: {
        type: "edSeasonalComparisonChart", 
        // Must match a key in `chartRegistry.js`, which maps to a React chart component.

        props: {
          dataSourceKey: "seasonalEDData", 
          // Key from the `data` section below. Chart receives `props.data`.
          virus: "{virus}", 
          // Template values are dynamically filled in based on page state (e.g. user toggles).
          view: "{view}" 
        }
      },

      modal: {
        title: "Seasonal ED {view}", 
        // Title for the help/info modal triggered by the (i) button.
        markdownPath: "../../public/content/modals/emergency-dept-explainer.md" 
        // Markdown content shown in the modal body.
      },

      infoIcon: true,       // Show modal info button
      downloadIcon: true,   // Show download button
      trendEnabled: true,   // Enables automatic trend detection/labeling
      animateOnScroll: true // Enables scroll-triggered fade-in
    }
  ],

  data: {
    seasonalEDData: [
      { week: "2025-01-01", visits: 12500, admits: 3100 },
      { week: "2025-01-08", visits: 13000, admits: 3200 },
      // Data format must match what the chart expects.
    ]
  },

  controls: {
    virusToggle: true, // Optional UI toggle to switch between viruses (e.g. COVID-19, RSV)
    viewToggle: true   // Optional UI toggle to switch between "visits" and "admits"
  }
}

```

üõ† How It Works
The page layout (ConfigDrivenPage.jsx) uses this config to render the header, summary, interactive controls, and charts.

Chart components are mapped by type in chartRegistry.js and automatically receive the right props.

You can interpolate {virus}, {view}, {trend}, etc., in strings‚Äîthese are resolved at runtime using current app state.



üîç Key Features
‚úÖ Markdown-Powered Content
Summary and modal content lives in .md files under /public/content/

Supports {view}, {virus}, {trend} templating in markdown

Optional ## Section targeting with fallback if not found

‚úÖ Interactive Controls
virusToggle: Filter by virus

viewToggle: Switch between ED visits and admits

Shared state provided via usePageState()

‚úÖ Chart Modularization
All charts are registered in /utils/chartRegistry.js

Components accept data, view, virus via props

Uses react-vega and Vega-Lite JSON specs

‚úÖ Responsive Layout
Grids use clamp()-based fluid spacing

Breakpoints and CSS modules for scoped styles

Components support fade-in animations on scroll

üìä Trend & Export Logic
Trends are computed via getTrendFromTimeSeries(data, metric)

Downloadable CSVs generated by downloadCSV(data, filename)

Summary cards and subtitles automatically show up/down arrows and percent change



